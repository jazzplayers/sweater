import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter_riverpod/legacy.dart';
import 'package:sweater/models/story_avatar.dart';
import 'package:sweater/features/sweatering/model/sweateringstatus.dart';

class AvatarRepository {
  final FirebaseFirestore _db;
  AvatarRepository(this._db);

  CollectionReference<Map<String, dynamic>> get avatarRef {
    return _db.collection('users').doc('uid').collection('avatars');
  }

  Stream<Map<String, dynamic>> watchAvatarDoc (String uid) {
    return avatarRef.doc(uid).snapshots().map((doc) {
      return doc.data() ?? {};
    });
  }

  DocumentReference<Map<String, dynamic>> avatarDocRef({
    required String uid,
  }) {
    return avatarRef.doc(uid);
  }

  Future<void> setUserAvatar(String uid, StoryAvatar avatar) async {
    await avatarDocRef(uid: uid).set(avatar.toMap(), SetOptions(merge: true));
  }

  Future<void> deleteUserAvatar(String uid) async {
    await avatarDocRef(uid: uid).delete();
  }

}

class AvatarSweateringNotifier extends StateNotifier<Sweateringstatus> {
  AvatarSweateringNotifier() : super(Sweateringstatus.none);                                                          

  void setStatus(Sweateringstatus status) {
    state = status;
  }
}


final avatarSweateringProvider = StateNotifierProvider.autoDispose<AvatarSweateringNotifier, Sweateringstatus>((ref) {
  return AvatarSweateringNotifier();
});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     